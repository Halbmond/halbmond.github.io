<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Halbmond">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Halbmond">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Halbmond">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Halbmond</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Halbmond</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/28/pkucampus2018/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Halbmond">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/28/pkucampus2018/" itemprop="url">
                  Pku Campus 2018 Solution
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-28 08:00:00" itemprop="dateCreated datePublished" datetime="2018-05-28T08:00:00+08:00">2018-05-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-07-06 10:42:10" itemprop="dateModified" datetime="2018-07-06T10:42:10+08:00">2018-07-06</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Acm/" itemprop="url" rel="index"><span itemprop="name">Acm</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>2018年北京大学acm校赛非正式意识流题解。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h4 id="A"><a href="#A" class="headerlink" title="A"></a>A</h4><p>列出线性规划式子，转为对偶型。<br>观察对偶型的线性规划式子，发现这是一个差分约束系统问题。<br>于是就可以用最短路求解。因为该图的特殊性，这种做法的时间复杂度为$O(N)$<br>事实上，我们可以证明，每一天要么花费0小时，要么花费7小时，然后直接DP或贪心即可。</p>
<h4 id="B"><a href="#B" class="headerlink" title="B"></a>B</h4><p>设郭神的初始资金为1元，$f(i)$表示恰好在第i天卖出时可获得资金的期望，$g(i)$表示恰好在第i天买入时所得份额数的期望。</p>
<script type="math/tex; mode=display">f(0)=1</script><script type="math/tex; mode=display">g(i)=\sum_{j=0}^{i-1} 1/(n-j)*f(j)*1/V_i</script><script type="math/tex; mode=display">f(i)=\sum_{j=1}^{i-1} 1/(n-j)*g(j)*V_i*r_{i-j}</script><p>对所求式子进行变形，发现数列${g(i)*V_i}$为数列${f(i)/(n-i)}$的前缀和，故g(i)可在常数时间求出。<br>对于f，可以使用分治。其中，计算区间[l,r]时，[l,m]对[m+1,r]的贡献可通过数列${g(i)/(n-i)}$与${r_i}$的卷积进行计算。<br>在分治过程中用FFT求卷积，需要进行常数优化以保证不会超时。<br>总时间复杂度$O(Nlog^2N)$</p>
<h4 id="C"><a href="#C" class="headerlink" title="C"></a>C</h4><p>记文档长度为$N$。直接KMP会超时，因为最多会进行$O(N)$次替换，每次替换最大长度200。<br>对S串构造KMP自动机，并预处理自动机每个节点插入T串任意一段后到达的节点。<br>插入T串过程中可能会再次匹配S，这种情况下，预处理出回退多少个节点。<br>而后不断处理文档，遇到要替换时，回退$len(S)$个节点后根据预处理结果处理插入T。<br>总时间复杂度$O(N+ST^2)$</p>
<h4 id="D"><a href="#D" class="headerlink" title="D"></a>D</h4><p>预处理计算出字符串两两之间的编辑距离。所有字符串为节点，字符<br>串的编辑距离为节点之间的边权，构成一个无向带权完全图。将所有边从<br>小到大排序，用Kruskal算法求最小生成树。每增加一条边时，都会合并两<br>个类，这时，只需检查合并后的类是否满足条件：这一类的字符串两两之<br>间的编辑距离严格小于这一类的字符串与其他类中的字符串之间的编辑距<br>离。将类G划分成若干(&gt;=1)个子类，记满足条件的方案总数为$F(G)$。若<br>不满足条件，由乘法原理，合并后的类方案总数为</p>
<script type="math/tex; mode=display">F(G1 \cup G2) = F(G1) * F(G2)</script><p>若满足条件，则新增了1种方案：也就是不对其作任何划分。合并后的类方<br>案总数为</p>
<script type="math/tex; mode=display">F(G1 \cup G2) = F(G1) * F(G2) + 1</script><h4 id="E"><a href="#E" class="headerlink" title="E"></a>E</h4><p><img src="/images/pkucampus2018/pkucampus2018E.png" alt="Rank"><br>全都是直角。<br>奇数个点：<br>把$n-1$的答案最右边的角上剪一个角，最优解为$n-2$个直角。<br>多边形内角和为180(n-2)，90度角只能为90或270度，若有$n$个直角，假设$x$个$90$度，则<br>180(n-2)=90x+270(n-x)<br>n-2x=-4<br>与$n$为奇数矛盾；<br>若有$n-1$个直角，则剩余的那个角一定是$90$的倍数，且既不是$90$也不是$270$，那只能是$180$或$360$，都与题意矛盾。</p>
<h4 id="F"><a href="#F" class="headerlink" title="F"></a>F</h4><p>考虑$f[i]$恒等于$i+1$的情况，可以证明方案总是为$(n+1)^{n-1}$。<br>证明：拓展一个位置$n+1$，令$f[n+1]=1￥。<br>这样构成了$n+1$的环，问题等价于放n个取值为[1,n+1]的数，并且$n+1$位置上没有数。<br>由对称性知答案为$\frac{(n+1)^n}{n+1}=(n+1)^{n-1}$。<br>把原问题拆成若干条链，利用乘法原理计算总方案数即可。</p>
<h4 id="G"><a href="#G" class="headerlink" title="G"></a>G</h4><p>先只考虑 $S[L, R]$,实质等价于求出由$X_i$($i=L…R$)组成的向量组 张成的子空间$W$的维度 $dimW$, 答案即为 $p^{dimW}$ 。<br>求解子空间的维度可以转换为维护子空间的基的问题,于是,可以通过类似高斯消元的方法,动态构造一个向量组的基:<br>依次向当前基中添加向量,记 $F[i]$ 为最大的非零分量下标为第 $i$ 个分量的向量。</p>
<p>对于待添加向量 $X_k$ ,从第一个分量开始枚举,如果 $X_k$ 的第 $i$ 个分量非零,则通过减去$F [i]$ 的若干倍消去这一分量,如果 $F [i] $为空,则证明当前待添加分量与现有基线性无关,可以并入基中。<br>重复此过程,可获得向量组的一组基。求基时间复杂度 $O(d^3)$。<br>接下来分析如何快速得到向量序列区间上的一组基:当没有修改操作时,可以采用分块算法,每次合并至多 $O(sqrt{N})$ 组基:合并方式为将基向量数量较少的一组基暴力添加至另一组基里即可,时间复杂度$O(d^3 )$。<br>故分块算法的初始化复杂度为 $O(d^2 N)$,询问时间复杂度为 $O(d^3\sqrt{N})$。<br>考虑用线段树维护子区间上的基,逐层暴力合并基即可。由于长度为 $N$ 的线段树<br>至多 $2N$ 个子区间,所以建树复杂度为 $O(d^2 N)$,询问时间复杂度为 $O(d^3logN)$。<br>题目中询问的是Synchronicity 值, 进行一些推导: 假设 $A$,$B$ 是两个子空间,<br>$|A \oplus B| = p^{dimA} + p^{dimB} - 2 p^{dim(A \cap B)}$ 。由维度公式可知 $dim(A \cap B) = dimA + dimB - dim(A + B)$。<br>而两个子空间之和的维度等价于求解两组基的并,依旧可以采用直接合并基解决。<br>修改操作只需要对线段树上某条路径的所有节点进行基合并操作即可,时间复杂度<br>$O(d^3 logN)$。线段树实现不好可能会超时。</p>
<h4 id="H"><a href="#H" class="headerlink" title="H"></a>H</h4><p>求最大质因子$X$，输出$2147483647/X$即可。</p>
<h4 id="I"><a href="#I" class="headerlink" title="I"></a>I</h4><p>设所填的最大正整数为$k$。<br>求一种填充方案等价于：求出$n$个集合$S_1,S_2,…,S_n$，使得$S_i$都是${1,2,3,…,k}$的子集，且任意$i≠j$，$S_j$都不是$S_i$的子集。<br>必要性：如果存在一种符合规则的方案，将第i列的所有数字构成集合$S_i$。对于第i行第j列的数字$x$，有$x∈S_j$，且第$i$列没有$x$，即$x$不属于$S_i$，所以有$S_j$不是$S_i$的子集。<br>充分性：方阵的第$i$行第$j$列填上集合$(S_j / S_i)$中的任意一个数字。<br>对于第$i$行第$j$列的数字$x$，显然第$i$列没有数字$x$，第$j$行也没有数字$x$（反证，如果第$j$行第$p$列有数字$x$，则说明$x∈(S_p / S_j)$，然而$x∈S_j$，产生矛盾）。<br>现要最小化$k$，即取最小的k使得$C(k, [k / 2])&gt;=n$。</p>
<h4 id="J"><a href="#J" class="headerlink" title="J"></a>J</h4><p>设$N$,$d$的答案为$f(N,d)$，注意到$f$关于$N$是积性函数，问题化作求解$f(p^n,d)$。<br>注意$p=2$与$p&gt;2$时，需要分别讨论。<br>$p&gt;2$时，$f(p^n,d)$的答案与$p%4$、$d$有关。<br>$p=2$时，$f(p^n,d)$的答案只与$d$有关。</p>
<h4 id="K"><a href="#K" class="headerlink" title="K"></a>K</h4><p>本题给定了有限种操作，我们考虑设计一些状态并确定状态之间的转移关系，然后可以通过两步之间的转移矩阵应用快速幂矩阵乘法得到T次的转移矩阵。<br>下面我们来研究在上述状态下的转移情况,我们用转移矩阵$A[i][j]$表示从状态i到状态j的可能操作数:<br>对于状态0,由于我们要求的是第一次达到目标的次数,所以对于在规定次数之前时刻,如果已经达到目标,则这样的结果应该被排除,所以$A[0][j]=0$。<br>对于操作 1 、 2 ,可以将任意一条边变为与之前不同的状态(开或关),那么处于状态i的任意一种显示屏形式,可通过操作 1 、 2 改变其与目标不同的i条边中任意一条变为状态$i-1$,共有$i$种选择;同样的可以通过改变与目标相同的$N-i$条边(设 $N$ 为总边数)中的任意一条变为状态$i+1$(对于边界情况如i=N时自然不会变到$i=N+1$) ,共有$N-i$种选择。<br>对于操作 3 、 4 、 5 ,首先,我们能发现这三个操作都改变了两条边,而且包含了任意改变两条边的操作。类似之前的讨论,我们发现,当我们改变的两条边都是与目标相同的时,从状态i变为$i-2$,此时改变的边共有$(N-i)(N-i-1)/2$种取法;当改变的两条边都是与目标不同时,状态从$i$变为$i+2$,共有$i(i-1)/2$种取法;当改变的两条边一条与目标相同,一条与目标不同时,状态不变,共有$i(N-i)$种取法。<br>综上,我们能得出转移矩阵满足:<br>$A[0][j]=0$,$A[i][i-1]=i$,$A[i][i+1]=N-k$,<br>$A[i][i-2]=i(i-1)/2,A[i][i+2]=(N-i)(N-i-1)/2,A[i][i]=i(N-i)$,其余均为 $0$ 。<br>得到转移矩阵以后,我们的目标就是计算$e11 * A^T$,即表示从初始状态经过T时刻后第一次变为目标的方法数,其中$e11$为只有状态11为1其余为0的行向量。这可以通过预处理矩阵快速幂算法得到。<br>由于有多组询问，需要预处理$A^{2^k}$，然后在处理询问时，根据T的二进制将$e11$乘以$A^{2^k}$。如果不做预处理，可能会超时。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/10/MCDC-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Halbmond">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/10/MCDC-1/" itemprop="url">
                  Momenta Car Detection Challenge
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-10 17:00:00" itemprop="dateCreated datePublished" datetime="2018-05-10T17:00:00+08:00">2018-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-28 16:48:43" itemprop="dateModified" datetime="2018-05-28T16:48:43+08:00">2018-05-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/Detection/" itemprop="url" rel="index"><span itemprop="name">Detection</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/Detection/Driveless-Car/" itemprop="url" rel="index"><span itemprop="name">Driveless Car</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>总的来说运气挺不错的，作为入选者中唯一一个没有任何 computer vision 背景，从零开始学习各种目标检测和滤波算法，有幸最后取得了 rank 2 的排名。<br>纵观这次长达一个月的比赛，总结一下自己比赛中显露出的自己的一些问题：</p>
<ol>
<li><p>没有及时把每天想到的 idea 记下来，进行 prioritize 再一一实现。<br>总是纠结于一些trivial的工作。（其实前期也有好好记录，到后面ddl一多就乱了阵脚）<br>后来知道冠军的做法中一个十分关键的 trick 当初也有想到过，可惜没有好好记下来后面就想不起来了。</p>
</li>
<li><p>数据分析熟练度欠佳，经验不足。<br>比如对噪声的处理，现实中遇到的数据的噪声存在太多难以解释的因素，<br>此时最好的办法还是使用可视化工具，观察数据的分布。<br>一些简单的clip操作，很多时候就能达到比那些听起来fancy的滤波器更理想的效果。</p>
</li>
<li><p>状态切换的能力欠佳，五一结束了还沉浸在假期的轻松心境中，期中季考完沉浸在对考题的缅怀感慨中。<br>而现在比赛结束了，明明即将迎来期末季与数不清的ddl的惨烈修罗场，<br>却又把大把的时间拿来思考人生。 假使我每次反复选中眼前的文本然后取消，对着屏幕出神时，能够怀有哪怕…哪怕一丁点的负罪感就好了。</p>
</li>
</ol>
<p>也十分感激各位 marketing manager 多次帮我安排了与各组的负责人的 talk，<br>有幸和公司的几位联合创始人一起用餐，<br>一方面也使得我从旁观者的视角，低成本理解一家 start-up 的运转，为自己未来的创业计划积累经验。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/How-to-get-full-points-on-malloc-lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Halbmond">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/28/How-to-get-full-points-on-malloc-lab/" itemprop="url">
                  How to get full points on malloc lab
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-12-28 18:00:00" itemprop="dateCreated datePublished" datetime="2016-12-28T18:00:00+08:00">2016-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-28 08:41:48" itemprop="dateModified" datetime="2018-05-28T08:41:48+08:00">2018-05-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Science/" itemprop="url" rel="index"><span itemprop="name">Computer Science</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>原本是受人所托，回来填坑。另一方面，也是想想这些事情，如果不赶紧记下来，将来就再也没办法找到了。这么一来，我这样恋旧的人大概会难过的吧。</p>
<p>——不然鬼知道这个原本定位慵懒小清新（?..）轻松日常的Blog，怎么会笔锋一转，写起了令人胃痛的malloc lab……</p>
<p>好啦好啦，接下来就开始正文吧</p>
<h2 id="Introduction-to-Computer-Systems"><a href="#Introduction-to-Computer-Systems" class="headerlink" title="Introduction to Computer Systems"></a>Introduction to Computer Systems</h2><p><a href="http://www.cs.cmu.edu/~./213/schedule.html" target="_blank" rel="noopener">Introduction to Computer Systems(ICS)</a> 这门课最早由cmu创立。2012年，北大信息科学技术学院与卡耐基梅隆大学计算机科学学院联合对该课程进行升级，并正式引入国内。</p>
<p>ICS 是北京大学信息科学技术学院的重点建设课程，课程由大班教学和小班研讨结合，并投入了大量师资。</p>
<p>malloc lab 是 ICS 中最具有挑战性的一个实验，笔者当时在 malloc lab 中取得了唯一的满分，下文简要阐述一些 malloc lab 的思路。</p>
<p><img src="/images/How-to-get-full-points-on-malloc-lab/ics-malloc-lab-rank.png" alt="Rank"></p>
<h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><ul>
<li><p>read through CS:APP Chapter 9 carefully and finish exercises</p>
<ul>
<li>understand some concepts:<ul>
<li>implementation<ul>
<li>implicit free list</li>
<li>explicit free list</li>
<li>segregated free list</li>
</ul>
</li>
<li>fit strategy<ul>
<li>first fit</li>
<li>next fit</li>
<li>best fit</li>
</ul>
</li>
<li>throughput</li>
<li>memory utilization<ul>
<li>payload</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>read through <code>malloclab-writeup.pdf</code></p>
</li>
<li><p>read two files in <code>malloclab-handout</code></p>
<ul>
<li><code>mm-naive.c</code></li>
<li><code>mm-textbook.c</code></li>
</ul>
</li>
</ul>
<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>malloc lab 的目标是实现类似 GNU libc 的 <code>malloc</code>, <code>free</code>, <code>realloc</code>, <code>calloc</code>函数，即实现一个动态内存分配器，以理解堆的内存分配机制。</p>
<h2 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h2><ul>
<li>Throughput (39%)<ul>
<li>we would like to maximize an allocator’s throughput, which is defined as the number of requests that it completes per unit time.</li>
</ul>
</li>
<li>memory utilization (61%)<ul>
<li>The peak ratio between the aggregate amount of memory used by the driver (i.e., allocated via malloc but not yet freed via free) and the size of the heap used by your allocator.</li>
</ul>
</li>
</ul>
<p>得分的评估包括两个方面</p>
<ul>
<li>吞吐量 (39%)</li>
</ul>
<ul>
<li>空间利用率 (61%) </li>
</ul>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>在malloc lab中，free操作会产生空闲的块，我们需要一个数据结构，支持这些块的插入，删除操作。并且在较少的时间内最大限度地利用空间。</p>
<p>如何维护这些空闲的块？</p>
<h4 id="Binary-Search-Tree"><a href="#Binary-Search-Tree" class="headerlink" title="Binary Search Tree"></a>Binary Search Tree</h4><p>为了提高空间利用率，我们考虑采用best fit策略，并使用平衡树维护。平衡树相比线段树，trie，附带的空间复杂度较低，并且能在$O(logn)$时间下完成插入，删除操作，具有十分不错的性质。</p>
<p>我们将平衡树的每个节点的结构体存入到空闲列表中。以 treap 为例，以如下这种方法，我们至少需要20 bytes的空闲链表来存储一个节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct node &#123;</span><br><span class="line">	node *left, *right, *next;</span><br><span class="line">	int size, random_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>left, right<ul>
<li>节点的左右子节点</li>
</ul>
</li>
<li>next<ul>
<li>指向一个链表，用来维护所有和该节点相同size的空闲块</li>
</ul>
</li>
<li>size<ul>
<li>空闲块的大小</li>
</ul>
</li>
<li>random_value<ul>
<li>节点分配到的随机值</li>
</ul>
</li>
</ul>
<h4 id="Linkedlist"><a href="#Linkedlist" class="headerlink" title="Linkedlist"></a>Linkedlist</h4><p>为了提高吞吐量，我们考虑用数组维护较小空闲块的链表头。</p>
<p>每次产生空闲块时，若</p>
<ul>
<li>空闲块的size &lt;= LIMIT，我们直接在这个数组中查找这些链表头<ul>
<li>必定能找到相应的链表头，我们直接往这个节点的链表中插入这个空闲块</li>
</ul>
</li>
<li>空闲块的size &gt; LIMIT，我们在平衡树中查找相应的链表头<ul>
<li>如果平衡树中存在相应size的节点，就往这个节点的链表中插入这个空闲块</li>
<li>如果平衡树中不存在相应size的节点，就往平衡树中插入这样的一个节点</li>
</ul>
</li>
</ul>
<h4 id="Fragment-Pool"><a href="#Fragment-Pool" class="headerlink" title="Fragment Pool"></a>Fragment Pool</h4><p>注意到trace 中的 exhaust.rep，boat.rep 等数据中，有大量小块的malloc, free操作，产生了大量无用的碎片。尤其是 8 bytes 的空闲块，一旦产生这样的碎片，除非coalesce，否则很难被再利用。</p>
<p>针对这一点，我们可以在heap的最前面开一个这样的池，管理这些碎片。</p>
<h2 id="Some-Tricks"><a href="#Some-Tricks" class="headerlink" title="Some Tricks"></a>Some Tricks</h2><h4 id="Trick-1"><a href="#Trick-1" class="headerlink" title="Trick 1"></a>Trick 1</h4><p>writeup中提到：堆的大小不会超过 $2^{32}$ 字节。</p>
<p>尽管 x86-64 机器下指针的空间是 8 字节，但我们完全可以只记录4字节的偏移量完成寻址。</p>
<h4 id="Trick-2"><a href="#Trick-2" class="headerlink" title="Trick 2"></a>Trick 2</h4><p>一个 thou 的瓶颈是系统调用。感谢当初sy2006菊苣提醒:）</p>
<p>pku 服务器的主频非常低，提交到服务器上时系统调用简直慢到怀疑人生。</p>
<ul>
<li>一个优化：每次申请空间时，直接sbrk一大块，以减少系统调用次数。<ul>
<li>这是个空间与时间的 trade-off<ul>
<li>单次sbrk过少，Throughput 下降</li>
<li>单次sbrk过多，Space Utilization 大打折扣</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Vincent</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  





  










  





  

  

  

  
  

  
  
    
      
        
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
  


  
  

  

  

  

  

  

</body>
</html>
